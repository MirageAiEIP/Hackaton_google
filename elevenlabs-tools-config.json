{
  "tools": [
    {
      "name": "get_current_call_info",
      "description": "‚≠ê MUST be called FIRST at the start of the conversation. Retrieves complete context about the current call including: patient identity, address, medical history, previous calls. Use this before any other action.",
      "parameters": {
        "type": "object",
        "properties": {
          "callId": {
            "type": "string",
            "description": "ID de l'appel en cours (optional - will be auto-resolved from conversation_id)"
          },
          "conversation_id": {
            "type": "string",
            "description": "ID de conversation ElevenLabs (automatically provided)"
          }
        }
      },
      "url": "https://your-backend-url.com/api/v1/tools/get_current_call_info"
    },
    {
      "name": "update_call_info",
      "description": "Update patient and call information during the conversation. Use this to record: patient name/address, chief complaint, symptoms, vital signs, priority level. All fields are optional - only update what the patient provides.",
      "parameters": {
        "type": "object",
        "properties": {
          "callId": {
            "type": "string",
            "description": "ID de l'appel en cours"
          },
          "conversation_id": {
            "type": "string",
            "description": "ID de conversation ElevenLabs (automatically provided)"
          },
          "patientInfo": {
            "type": "object",
            "description": "Patient administrative information",
            "properties": {
              "firstName": { "type": "string" },
              "lastName": { "type": "string" },
              "age": { "type": "number" },
              "gender": { "type": "string", "enum": ["MALE", "FEMALE", "OTHER"] },
              "address": { "type": "string" },
              "city": { "type": "string" },
              "postalCode": { "type": "string" }
            }
          },
          "callInfo": {
            "type": "object",
            "description": "Medical call information",
            "properties": {
              "chiefComplaint": { "type": "string", "description": "Main reason for calling" },
              "currentSymptoms": { "type": "string", "description": "Current symptoms description" },
              "priority": {
                "type": "string",
                "enum": ["P0", "P1", "P2", "P3"],
                "description": "Priority level: P0 (absolute emergency), P1 (emergency), P2 (urgent), P3 (non-urgent)"
              },
              "priorityReason": { "type": "string", "description": "Justification for priority level" },
              "vitalSigns": {
                "type": "object",
                "description": "Vital signs if provided by patient",
                "properties": {
                  "heartRate": { "type": "number" },
                  "bloodPressure": { "type": "string" },
                  "temperature": { "type": "number" },
                  "respiratoryRate": { "type": "number" }
                }
              }
            }
          }
        },
        "required": ["callId"]
      },
      "url": "https://your-backend-url.com/api/v1/tools/update_call_info"
    },
    {
      "name": "check_operator_available",
      "description": "Check if a human operator is currently available. If not available, automatically adds the call to the queue and returns the queue position and estimated wait time. Use this BEFORE requesting handoff.",
      "parameters": {
        "type": "object",
        "properties": {
          "callId": {
            "type": "string",
            "description": "ID de l'appel en cours"
          },
          "conversation_id": {
            "type": "string",
            "description": "ID de conversation ElevenLabs (automatically provided)"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"],
            "description": "Call priority level"
          }
        },
        "required": ["priority"]
      },
      "url": "https://your-backend-url.com/api/v1/tools/check_operator_available"
    },
    {
      "name": "request_human_handoff",
      "description": "Request handoff from AI agent to human operator. Use this when: (1) Patient explicitly requests to speak with a human, (2) Medical case is too complex for AI triage, (3) Patient is distressed and needs human empathy, (4) Escalation to doctor/specialist is needed. Provides full conversation context to operator.",
      "parameters": {
        "type": "object",
        "properties": {
          "callId": {
            "type": "string",
            "description": "Unique call identifier"
          },
          "conversationId": {
            "type": "string",
            "description": "ElevenLabs conversation ID"
          },
          "reason": {
            "type": "string",
            "description": "Reason for handoff (e.g., 'Patient requested human', 'Complex medical case', 'Escalation needed')"
          },
          "transcript": {
            "type": "string",
            "description": "Full conversation transcript up to this point"
          },
          "patientSummary": {
            "type": "string",
            "description": "AI-generated summary of patient situation (symptoms, urgency, key information)"
          },
          "aiContext": {
            "type": "object",
            "description": "Additional AI context (detected symptoms, priority, etc.)"
          }
        },
        "required": ["callId", "conversationId", "reason", "transcript", "patientSummary"]
      },
      "url": "https://your-backend-url.com/api/v1/tools/request_human_handoff"
    },
    {
      "name": "get_patient_history",
      "description": "Retrieve patient's complete medical history including: chronic conditions, allergies, current medications, and previous SAMU calls. Use this when patient mentions existing health conditions or when evaluating medical context.",
      "parameters": {
        "type": "object",
        "properties": {
          "callId": {
            "type": "string",
            "description": "ID de l'appel en cours"
          },
          "conversation_id": {
            "type": "string",
            "description": "ID de conversation ElevenLabs (automatically provided)"
          }
        }
      },
      "url": "https://your-backend-url.com/api/v1/tools/get_patient_history"
    },
    {
      "name": "get_pharmacy_on_duty",
      "description": "Find pharmacies currently open (on duty) near the patient's location. Returns pharmacy names, addresses, phone numbers, and opening hours. Use this when patient needs medication but it's not an emergency requiring ambulance.",
      "parameters": {
        "type": "object",
        "properties": {
          "city": {
            "type": "string",
            "description": "City name (e.g., 'Paris', 'Lyon')"
          },
          "postalCode": {
            "type": "string",
            "description": "Postal code for more precise search"
          },
          "departmentCode": {
            "type": "string",
            "description": "French department code (e.g., '75' for Paris)"
          }
        }
      },
      "url": "https://your-backend-url.com/api/v1/tools/get_pharmacy_on_duty"
    },
    {
      "name": "dispatch_smur",
      "description": "üöë Dispatch SMUR ambulance for emergency medical intervention. Use ONLY for life-threatening emergencies (P0/P1): cardiac arrest, severe trauma, stroke, difficulty breathing, severe bleeding. Requires patient location.",
      "parameters": {
        "type": "object",
        "properties": {
          "callId": {
            "type": "string",
            "description": "ID de l'appel en cours"
          },
          "reason": {
            "type": "string",
            "description": "Medical reason for dispatch (e.g., 'Cardiac arrest', 'Severe trauma')"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1"],
            "description": "Emergency priority (P0: absolute emergency, P1: emergency)"
          },
          "patientLocation": {
            "type": "object",
            "description": "Patient's precise location",
            "properties": {
              "address": { "type": "string" },
              "city": { "type": "string" },
              "postalCode": { "type": "string" },
              "additionalInfo": { "type": "string", "description": "Floor, building, access code" }
            },
            "required": ["address", "city"]
          }
        },
        "required": ["callId", "reason", "priority", "patientLocation"]
      },
      "url": "https://your-backend-url.com/api/v1/tools/dispatch_smur"
    }
  ],
  "setup_instructions": {
    "step_1": "Replace 'your-backend-url.com' with your actual backend URL (e.g., 'api.samu-ai.com' or 'localhost:3000' for dev)",
    "step_2": "In ElevenLabs Dashboard, go to your agent ‚Üí Tools ‚Üí Add Client Tool",
    "step_3": "For each tool above, create a new Client Tool with the name, description, parameters, and URL",
    "step_4": "Update your agent's system prompt to instruct it to ALWAYS call get_current_call_info FIRST",
    "step_5": "Test by starting a conversation and checking backend logs"
  },
  "agent_prompt_addition": "IMPORTANT INSTRUCTIONS:\n\n1. At the START of EVERY conversation, you MUST call get_current_call_info FIRST to retrieve patient context.\n2. As you gather information, continuously call update_call_info to record symptoms, priority, and patient details.\n3. Before requesting handoff, always call check_operator_available first.\n4. Only use dispatch_smur for absolute emergencies (P0/P1).\n5. Use get_patient_history when patient mentions chronic conditions or allergies.\n\nTool call order: get_current_call_info ‚Üí update_call_info (ongoing) ‚Üí [conditional tools] ‚Üí check_operator_available ‚Üí request_human_handoff"
}
