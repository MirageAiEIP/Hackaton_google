#!/usr/bin/env node
/**
 * Batterie COMPL√àTE de 100 tests pour l'analyse de sentiment Gemini
 * Couvre tous les sc√©narios possibles pour le hackathon Google
 */

const axios = require('axios');

const API_URL = 'http://localhost:3000/api/v1/sentiment/analyze';

const colors = {
  reset: '\x1b[0m',
  green: '\x1b[32m',
  red: '\x1b[31m',
  yellow: '\x1b[33m',
  blue: '\x1b[34m',
  magenta: '\x1b[35m',
  cyan: '\x1b[36m',
};

const testCases = [
  // ========== URGENCES VITALES P0/P1 (score 85-100) - 25 cas ==========
  {
    name: 'üö® P0 - Arr√™t cardiaque',
    callId: 'p0-cardiac-arrest-1',
    transcript: "All√¥ ! Mon mari ne respire plus ! Il est tomb√©, il bouge plus du tout ! Vite !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P0 - Arr√™t cardiaque (panique extr√™me)',
    callId: 'p0-cardiac-arrest-2',
    transcript: "Au secours ! Au secours ! Il respire plus ! Aidez-moi ! Je sais pas quoi faire ! Vite !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P0 - Inconscience totale',
    callId: 'p0-unconscious',
    transcript: "Mon p√®re est inconscient ! Il r√©pond plus ! Il est tout mou ! Venez vite s'il vous pla√Æt !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - H√©morragie massive',
    callId: 'p1-hemorrhage-1',
    transcript: "Il y a du sang partout ! Mon fils s'est coup√© avec une scie, √ßa saigne √©norm√©ment ! Aidez-moi !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - H√©morragie post-accouchement',
    callId: 'p1-hemorrhage-2',
    transcript: "Ma femme vient d'accoucher, elle perd beaucoup de sang, vraiment beaucoup ! Elle est toute p√¢le !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - AVC classique',
    callId: 'p1-stroke-1',
    transcript: "Ma femme, sa bouche est tordue d'un c√¥t√©, elle arrive pas √† lever le bras droit. Elle parle bizarre.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - AVC avec confusion',
    callId: 'p1-stroke-2',
    transcript: "Mon mari dit n'importe quoi, son visage est bizarre, un c√¥t√© bouge plus. C'est arriv√© d'un coup il y a 15 minutes.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - AVC avec paralysie',
    callId: 'p1-stroke-3',
    transcript: "Maman est tomb√©e, maintenant tout le c√¥t√© gauche bouge plus, sa bouche tombe, elle parle pas bien.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - D√©tresse respiratoire s√©v√®re',
    callId: 'p1-respiratory-1',
    transcript: "J'arrive plus √† respirer ! J'√©touffe ! Mes l√®vres deviennent bleues ! Aidez-moi vite !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Asphyxie',
    callId: 'p1-choking',
    transcript: "Mon b√©b√© s'est √©touff√© avec quelque chose ! Il respire plus ! Il devient bleu ! Au secours !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Traumatisme cr√¢nien grave',
    callId: 'p1-head-trauma-1',
    transcript: "Mon fils est tomb√© de l'√©chelle, il saigne de la t√™te, il r√©pond plus ! Il a les yeux ouverts mais il me voit pas !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Accident de voiture grave',
    callId: 'p1-car-accident',
    transcript: "Il y a eu un accident ! La personne est coinc√©e dans la voiture, elle saigne beaucoup, elle respire avec difficult√© !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Br√ªlure grave',
    callId: 'p1-burns',
    transcript: "Mon mari a renvers√© de l'huile bouillante sur lui ! C'est tout rouge et blanc ! Il crie de douleur !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Convulsions',
    callId: 'p1-seizure',
    transcript: "Mon enfant fait une crise ! Il tremble de partout, il bave, ses yeux roulent ! √áa s'arr√™te pas !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - R√©action allergique s√©v√®re',
    callId: 'p1-anaphylaxis',
    transcript: "Mon fils a mang√© des cacahu√®tes, maintenant son visage gonfle, sa gorge gonfle, il respire de plus en plus mal !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Overdose m√©dicamenteuse',
    callId: 'p1-overdose',
    transcript: "J'ai trouv√© ma fille par terre avec des bo√Ætes de m√©dicaments vides ! Elle r√©pond pas ! Je vois pas si elle respire !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Noyade',
    callId: 'p1-drowning',
    transcript: "On vient de sortir un enfant de la piscine ! Il respire pas ! Il est tout bleu ! Qu'est-ce qu'on fait ?!",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Accouchement imminent',
    callId: 'p1-birth',
    transcript: "Ma femme est en train d'accoucher ! Le b√©b√© arrive ! Je vois la t√™te ! Qu'est-ce que je fais ?!",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - √âlectrocution',
    callId: 'p1-electrocution',
    transcript: "Mon coll√®gue a touch√© un fil √©lectrique ! Il est tomb√© ! Il bouge plus ! Il respire bizarrement !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Chute d\'une grande hauteur',
    callId: 'p1-fall',
    transcript: "Un ouvrier est tomb√© du toit ! Il est tomb√© de 6 m√®tres ! Il bouge plus, il saigne !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Pendaison/Tentative de suicide',
    callId: 'p1-hanging',
    transcript: "J'ai trouv√© mon fr√®re pendu dans sa chambre ! Je l'ai d√©croch√© mais il respire tr√®s mal ! Vite !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Amputation traumatique',
    callId: 'p1-amputation',
    transcript: "Il s'est coup√© la main avec la machine ! La main est coup√©e ! Il y a du sang partout !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - B√©b√© qui ne respire pas',
    callId: 'p1-baby-not-breathing',
    transcript: "Mon b√©b√© de 3 mois respire plus ! Il est tout mou ! Il est bleu ! Au secours !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - Intoxication au CO',
    callId: 'p1-co-poisoning',
    transcript: "Toute la famille est malade ! On a des maux de t√™te terribles, des vomissements ! Le d√©tecteur de CO sonne !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },
  {
    name: 'üö® P1 - D√©compensation cardiaque aigu√´',
    callId: 'p1-heart-failure',
    transcript: "Mon p√®re arrive plus √† respirer du tout ! Il est assis, il crache du liquide rose ! Il va mourir !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 85, max: 100 },
  },

  // ========== URGENCES IMPORTANTES P2 (score 70-84) - 25 cas ==========
  {
    name: '‚ö†Ô∏è P2 - Douleur thoracique classique',
    callId: 'p2-chest-pain-1',
    transcript: "J'ai une douleur tr√®s forte dans la poitrine depuis 10 minutes. √áa serre, √ßa irradie dans le bras gauche.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Douleur thoracique avec sueurs',
    callId: 'p2-chest-pain-2',
    transcript: "J'ai mal dans la poitrine, je transpire beaucoup, j'ai des naus√©es. J'ai peur que ce soit le c≈ìur.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Crise d\'asthme s√©v√®re',
    callId: 'p2-asthma',
    transcript: "J'ai fait une crise d'asthme, mon inhalateur marche pas. J'ai du mal √† respirer. Aidez-moi.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Diab√®te d√©compens√©',
    callId: 'p2-diabetes',
    transcript: "Je suis diab√©tique, j'ai fait un malaise, je tremble, je vois flou, je transpire √©norm√©ment.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Fracture ouverte',
    callId: 'p2-open-fracture',
    transcript: "Je suis tomb√© √† v√©lo, ma jambe est cass√©e, l'os sort de la peau. √áa saigne et √ßa fait tr√®s mal.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Traumatisme cr√¢nien mod√©r√©',
    callId: 'p2-head-trauma-2',
    transcript: "Mon fils est tomb√©, il a vomi deux fois, il a tr√®s mal √† la t√™te, il voit double.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Douleur abdominale aigu√´',
    callId: 'p2-appendicitis',
    transcript: "J'ai une douleur atroce en bas √† droite du ventre. √áa a commenc√© ce matin, √ßa empire. Je peux plus bouger.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Colique n√©phr√©tique',
    callId: 'p2-kidney-stone',
    transcript: "J'ai une douleur insupportable dans le dos qui descend dans l'aine. Je vomis, √ßa fait tr√®s tr√®s mal.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Grossesse avec saignements',
    callId: 'p2-pregnancy-bleeding',
    transcript: "Je suis enceinte de 7 mois, j'ai des saignements importants et des contractions douloureuses.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Intoxication alimentaire s√©v√®re',
    callId: 'p2-food-poisoning',
    transcript: "Je vomis sans arr√™t depuis 6 heures, j'ai de la diarrh√©e, je me sens tr√®s faible, j'arrive plus √† boire.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Fi√®vre √©lev√©e avec raideur nuque',
    callId: 'p2-meningitis',
    transcript: "Mon fils a 40 de fi√®vre, il a le cou tout raide, la lumi√®re lui fait mal aux yeux, il vomit.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Plaie profonde',
    callId: 'p2-deep-wound',
    transcript: "Je me suis coup√© profond√©ment avec un couteau, c'est une grosse entaille, √ßa saigne beaucoup mais j'arrive √† comprimer.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Crise de panique s√©v√®re',
    callId: 'p2-panic-attack',
    transcript: "Je peux plus respirer ! Mon c≈ìur bat tr√®s vite ! J'ai l'impression que je vais mourir ! Aidez-moi !",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Morsure de chien',
    callId: 'p2-dog-bite',
    transcript: "Un chien m'a mordu √† la jambe, c'est une grosse plaie profonde, √ßa saigne pas mal.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Troubles neurologiques',
    callId: 'p2-neuro',
    transcript: "J'ai des fourmillements dans tout le bras gauche, j'ai tr√®s mal √† la t√™te, je vois des √©clairs.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - R√©tention urinaire',
    callId: 'p2-urinary-retention',
    transcript: "Je peux plus uriner depuis 12 heures, j'ai le ventre gonfl√© et tr√®s douloureux.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Luxation √©paule',
    callId: 'p2-shoulder-dislocation',
    transcript: "Mon √©paule est sortie, je l'ai d√©bo√Æt√©e en faisant du sport. √áa fait tr√®s mal, je peux plus bouger le bras.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Crise d\'√©pilepsie prolong√©e',
    callId: 'p2-epilepsy',
    transcript: "Ma fille √©pileptique fait une crise qui dure depuis 5 minutes, elle s'arr√™te pas.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Confusion mentale aigu√´',
    callId: 'p2-confusion',
    transcript: "Mon p√®re de 80 ans dit n'importe quoi depuis ce matin, il me reconna√Æt plus, il est agit√©.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Saignement digestif',
    callId: 'p2-gi-bleeding',
    transcript: "Je vomis du sang rouge, j'en ai vomi plusieurs fois. Je me sens faible et √©tourdi.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Pneumothorax',
    callId: 'p2-pneumothorax',
    transcript: "J'ai eu un coup dans les c√¥tes, maintenant j'ai tr√®s mal pour respirer, √ßa fait un bruit bizarre.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Occlusion intestinale',
    callId: 'p2-bowel-obstruction',
    transcript: "J'ai mal au ventre depuis 2 jours, je vomis tout ce que je mange, je suis ballonn√©, je vais plus aux toilettes.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Phl√©bite',
    callId: 'p2-dvt',
    transcript: "J'ai le mollet gonfl√©, rouge, chaud et tr√®s douloureux. C'est arriv√© en quelques heures.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Crise de goutte',
    callId: 'p2-gout',
    transcript: "Mon gros orteil est gonfl√©, tout rouge, j'ai une douleur atroce, je peux m√™me pas poser le pied par terre.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },
  {
    name: '‚ö†Ô∏è P2 - Palpitations s√©v√®res',
    callId: 'p2-palpitations',
    transcript: "Mon c≈ìur bat tr√®s vite depuis une heure, je sens qu'il bat n'importe comment, j'ai des vertiges.",
    expectedRecommendation: 'INCREASE_PRIORITY',
    expectedScore: { min: 70, max: 90 },
  },

  // ========== CAS MOD√âR√âS P3 (score 40-69) - 25 cas ==========
  {
    name: 'üü° P3 - Douleur abdominale mod√©r√©e',
    callId: 'p3-abdominal-pain',
    transcript: "Bonjour, j'ai mal au ventre depuis ce matin. C'est vraiment douloureux. Je sais pas si je dois venir.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Fi√®vre √©lev√©e enfant',
    callId: 'p3-fever-child',
    transcript: "Mon enfant a 39.5 de fi√®vre depuis hier soir. Il est un peu faible mais il boit.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Entorse cheville',
    callId: 'p3-ankle-sprain',
    transcript: "Je me suis tordu la cheville en faisant du sport. C'est gonfl√© et √ßa fait mal quand je marche.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Gastro-ent√©rite',
    callId: 'p3-gastro',
    transcript: "J'ai la gastro, je vomis et j'ai la diarrh√©e depuis ce matin. Je suis fatigu√©.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Coupure superficielle',
    callId: 'p3-cut',
    transcript: "Je me suis coup√© en cuisine, c'est une coupure nette, √ßa saigne un peu, je me demande si il faut des points.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Infection urinaire',
    callId: 'p3-uti',
    transcript: "J'ai des br√ªlures quand j'urine, j'ai envie d'uriner tout le temps, j'ai un peu mal au dos.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Crise d\'asthme l√©g√®re',
    callId: 'p3-mild-asthma',
    transcript: "J'ai un peu de mal √† respirer, je pense que c'est l'asthme, mon inhalateur aide un peu.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Douleur dentaire',
    callId: 'p3-tooth-pain',
    transcript: "J'ai tr√®s mal aux dents depuis hier, c'est lancinant, j'ai essay√© des anti-douleurs mais √ßa passe pas.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Lombalgie aigu√´',
    callId: 'p3-back-pain',
    transcript: "Je me suis bloqu√© le dos ce matin, j'ai tr√®s mal, je peux presque plus bouger.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Migraine s√©v√®re',
    callId: 'p3-migraine',
    transcript: "J'ai une migraine terrible, j'ai vomi, la lumi√®re me fait mal, mes m√©dicaments marchent pas.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Angine',
    callId: 'p3-sore-throat',
    transcript: "J'ai tr√®s mal √† la gorge, j'ai du mal √† avaler, j'ai un peu de fi√®vre.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Otite',
    callId: 'p3-ear-infection',
    transcript: "Mon enfant a tr√®s mal √† l'oreille, il pleure beaucoup, il a de la fi√®vre.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Piq√ªre d\'insecte gonfl√©e',
    callId: 'p3-insect-bite',
    transcript: "J'ai √©t√© piqu√© par quelque chose, c'est tout gonfl√© et rouge, √ßa fait mal.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Bronchite',
    callId: 'p3-bronchitis',
    transcript: "Je tousse beaucoup depuis 3 jours, j'ai de la fi√®vre, je crache vert.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Ecz√©ma infect√©',
    callId: 'p3-eczema',
    transcript: "Mon ecz√©ma s'est infect√©, c'est tout rouge, √ßa suinte, √ßa fait mal.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Conjonctivite',
    callId: 'p3-conjunctivitis',
    transcript: "J'ai l'≈ìil tout rouge et qui colle, √ßa me d√©mange, √ßa pleure.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Vertige',
    callId: 'p3-vertigo',
    transcript: "J'ai des vertiges depuis ce matin, tout tourne, j'ai un peu mal au c≈ìur.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Urticaire',
    callId: 'p3-hives',
    transcript: "J'ai des plaques rouges partout qui me d√©mangent √©norm√©ment, je sais pas ce que c'est.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - H√©matome important',
    callId: 'p3-hematoma',
    transcript: "Je suis tomb√©, j'ai un gros bleu qui enfle sur la cuisse, c'est douloureux.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - H√©morro√Ødes',
    callId: 'p3-hemorrhoids',
    transcript: "J'ai tr√®s mal quand je vais √† la selle, j'ai vu du sang, je pense que ce sont des h√©morro√Ødes.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Torticolis',
    callId: 'p3-stiff-neck',
    transcript: "J'ai le cou bloqu√© depuis ce matin, je peux plus tourner la t√™te, c'est tr√®s douloureux.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Entorse doigt',
    callId: 'p3-finger-sprain',
    transcript: "Je me suis coinc√© le doigt dans une porte, c'est gonfl√©, bleu, je peux plus le plier.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Sinusite',
    callId: 'p3-sinusitis',
    transcript: "J'ai mal au front et aux joues, j'ai le nez bouch√©, de la fi√®vre mod√©r√©e.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - Douleur musculaire',
    callId: 'p3-muscle-pain',
    transcript: "Je me suis fait un claquage au mollet en courant, √ßa fait mal mais je peux marcher.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },
  {
    name: 'üü° P3 - R√®gles douloureuses',
    callId: 'p3-period-pain',
    transcript: "J'ai des r√®gles tr√®s douloureuses, j'ai mal au ventre, mes anti-douleurs habituels marchent pas.",
    expectedRecommendation: 'MAINTAIN',
    expectedScore: { min: 40, max: 69 },
  },

  // ========== CAS NON URGENTS P4/P5 (score 0-39) - 25 cas ==========
  {
    name: 'üü¢ P5 - Demande pharmacie de garde',
    callId: 'p5-pharmacy-info',
    transcript: "Oui bonjour, je voudrais savoir quelle est la pharmacie de garde s'il vous pla√Æt.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P5 - Demande m√©decin de garde',
    callId: 'p5-doctor-info',
    transcript: "Bonjour, j'aurais besoin des coordonn√©es du m√©decin de garde pour ce week-end.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Mal de t√™te l√©ger',
    callId: 'p4-mild-headache',
    transcript: "Bonjour, j'ai un peu mal √† la t√™te depuis ce matin. C'est supportable mais √ßa persiste.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Petite toux',
    callId: 'p4-mild-cough',
    transcript: "J'ai une petite toux qui dure depuis quelques jours. Pas de fi√®vre, je me sens bien sinon.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Rhume',
    callId: 'p4-cold',
    transcript: "J'ai le nez qui coule, j'√©ternue, j'ai un peu mal √† la gorge. C'est un rhume classique.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P5 - Question sur m√©dicament',
    callId: 'p5-medication-question',
    transcript: "Je voudrais savoir si je peux prendre du parac√©tamol avec mon traitement habituel.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Petite √©gratignure',
    callId: 'p4-scratch',
    transcript: "Je me suis √©gratign√© avec une ronce, c'est superficiel, je voulais savoir si il faut d√©sinfecter.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Fatigue g√©n√©rale',
    callId: 'p4-fatigue',
    transcript: "Je suis tr√®s fatigu√© depuis quelques jours, je voudrais un conseil.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P5 - Prise de RDV',
    callId: 'p5-appointment',
    transcript: "Bonjour, je voudrais prendre rendez-vous avec un m√©decin g√©n√©raliste.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Insomnie',
    callId: 'p4-insomnia',
    transcript: "Je dors mal depuis quelques nuits, je me demande si je devrais consulter.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Probl√®me de peau mineur',
    callId: 'p4-skin-minor',
    transcript: "J'ai un petit bouton qui est apparu, c'est rouge mais pas tr√®s g√™nant.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P5 - Demande d\'ordonnance',
    callId: 'p5-prescription',
    transcript: "J'ai besoin d'un renouvellement d'ordonnance pour mon traitement habituel.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Douleur musculaire l√©g√®re',
    callId: 'p4-muscle-ache',
    transcript: "J'ai un peu mal aux muscles depuis que j'ai fait du sport, c'est des courbatures je pense.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Acn√©',
    callId: 'p4-acne',
    transcript: "Mon acn√© empire, je voudrais un traitement plus efficace.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P5 - Conseil vaccin',
    callId: 'p5-vaccine',
    transcript: "Je pars en voyage, je voudrais savoir quels vaccins il me faut.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Constipation',
    callId: 'p4-constipation',
    transcript: "Je suis constip√© depuis quelques jours, c'est g√™nant mais pas douloureux.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Perte de poids souhait√©e',
    callId: 'p4-weight-loss',
    transcript: "Je voudrais perdre du poids, je cherche des conseils nutritionnels.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P5 - Question administrative',
    callId: 'p5-admin',
    transcript: "J'ai besoin d'un certificat m√©dical pour le sport, comment faire ?",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Allergie saisonni√®re',
    callId: 'p4-hay-fever',
    transcript: "J'ai le rhume des foins, les yeux qui piquent et qui pleurent, le nez qui coule.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Verrues',
    callId: 'p4-warts',
    transcript: "J'ai des verrues plantaires, je voudrais les faire enlever.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Douleur l√©g√®re chronique',
    callId: 'p4-chronic-pain',
    transcript: "J'ai mal au genou depuis longtemps, c'est supportable mais je voudrais un avis.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P5 - Demande de conseil g√©n√©ral',
    callId: 'p5-general-advice',
    transcript: "Je voudrais des conseils pour mieux dormir et g√©rer le stress.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Petite br√ªlure',
    callId: 'p4-minor-burn',
    transcript: "Je me suis br√ªl√© l√©g√®rement en cuisinant, c'est rouge mais pas de cloque.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P4 - Hoquet persistant',
    callId: 'p4-hiccups',
    transcript: "J'ai le hoquet depuis plusieurs heures, c'est g√™nant, comment l'arr√™ter ?",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
  {
    name: 'üü¢ P5 - Fausse alerte',
    callId: 'p5-false-alarm',
    transcript: "Pardon, j'ai appel√© par erreur, tout va bien, d√©sol√©.",
    expectedRecommendation: 'DECREASE_PRIORITY',
    expectedScore: { min: 0, max: 39 },
  },
];

async function runTest(testCase, index, total) {
  try {
    console.log(`\n${'='.repeat(80)}`);
    console.log(`${colors.cyan}TEST ${index}/${total}: ${testCase.name}${colors.reset}`);
    console.log(`${colors.blue}Transcript: "${testCase.transcript}"${colors.reset}`);

    const response = await axios.post(
      API_URL,
      {
        callId: testCase.callId,
        transcript: testCase.transcript,
      },
      {
        headers: {
          'Content-Type': 'application/json',
        },
      }
    );

    const result = response.data.data;

    // Afficher les r√©sultats de mani√®re concise
    const scoreMatch = result.finalScore >= testCase.expectedScore.min && result.finalScore <= testCase.expectedScore.max;
    const recommendationMatch = result.recommendation === testCase.expectedRecommendation;
    const passed = scoreMatch && recommendationMatch;

    const status = passed ? `${colors.green}‚úÖ PASS${colors.reset}` : `${colors.red}‚ùå FAIL${colors.reset}`;
    console.log(`${status} | Score: ${result.finalScore}/100 | Rec: ${result.recommendation} | Conf: ${(result.confidence * 100).toFixed(0)}%`);

    if (!passed) {
      console.log(`${colors.yellow}  Expected: ${testCase.expectedScore.min}-${testCase.expectedScore.max}, ${testCase.expectedRecommendation}${colors.reset}`);
    }

    return { testCase, result, passed };
  } catch (error) {
    console.error(`\n${colors.red}‚ùå ERREUR:${colors.reset}`, error.message);
    return { testCase, error: error.message, passed: false };
  }
}

async function runAllTests() {
  console.log(`${colors.cyan}${'='.repeat(80)}`);
  console.log(`üß™ BATTERIE COMPL√àTE - 100 TESTS GEMINI`);
  console.log(`${'='.repeat(80)}${colors.reset}\n`);

  const results = [];
  const startTime = Date.now();

  for (let i = 0; i < testCases.length; i++) {
    const result = await runTest(testCases[i], i + 1, testCases.length);
    results.push(result);

    // Pause courte entre tests
    await new Promise((resolve) => setTimeout(resolve, 500));
  }

  const endTime = Date.now();
  const duration = ((endTime - startTime) / 1000).toFixed(1);

  // R√©sum√© final
  console.log(`\n\n${colors.cyan}${'='.repeat(80)}`);
  console.log(`üìä R√âSUM√â FINAL - 100 TESTS`);
  console.log(`${'='.repeat(80)}${colors.reset}\n`);

  const passed = results.filter((r) => r.passed).length;
  const total = results.length;
  const percentage = ((passed / total) * 100).toFixed(1);

  console.log(`Temps d'ex√©cution: ${duration}s`);
  console.log(`Tests r√©ussis: ${colors.green}${passed}/${total}${colors.reset} (${percentage}%)`);

  // Stats par cat√©gorie
  const categories = {
    'P0/P1 (Urgences vitales)': results.slice(0, 25),
    'P2 (Urgences importantes)': results.slice(25, 50),
    'P3 (Cas mod√©r√©s)': results.slice(50, 75),
    'P4/P5 (Non urgents)': results.slice(75, 100),
  };

  console.log(`\n${colors.magenta}üìà STATS PAR CAT√âGORIE:${colors.reset}`);
  for (const [category, categoryResults] of Object.entries(categories)) {
    const categoryPassed = categoryResults.filter((r) => r.passed).length;
    const categoryTotal = categoryResults.length;
    const categoryPercentage = ((categoryPassed / categoryTotal) * 100).toFixed(1);
    const color = categoryPercentage >= 90 ? colors.green : categoryPercentage >= 70 ? colors.yellow : colors.red;
    console.log(`  ${category}: ${color}${categoryPassed}/${categoryTotal}${colors.reset} (${categoryPercentage}%)`);
  }

  const failed = results.filter((r) => !r.passed);
  if (failed.length > 0) {
    console.log(`\n${colors.red}‚ùå Tests √©chou√©s (${failed.length}):${colors.reset}`);
    failed.forEach((r, idx) => {
      if (idx < 20) { // Afficher max 20 √©checs pour pas surcharger
        console.log(`  ${idx + 1}. ${r.testCase.name}`);
      }
    });
    if (failed.length > 20) {
      console.log(`  ... et ${failed.length - 20} autres`);
    }
  }

  console.log(`\n${colors.cyan}${'='.repeat(80)}${colors.reset}\n`);

  // Exit code
  process.exit(failed.length > 0 ? 1 : 0);
}

// Lancer tous les tests
runAllTests().catch((error) => {
  console.error(`${colors.red}Erreur fatale:${colors.reset}`, error);
  process.exit(1);
});
